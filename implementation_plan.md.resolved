# Relocate "Build Your Funnel" Button to Phase 2

## Goal Description
Move the "Build Your Funnel" button from Phase 3 (implied or "Vault Complete" view) to Phase 2 completion. When Phase 2 is approved, users should be prompted to "Build Your Funnel". Clicking this deploys the funnel. After deployment, users are presented with options to "Go to Phase 3" or "Go to Builder Login".

## User Review Required
> [!NOTE]
> The "Proceed to Phase 3" button in the Phase 2 completion block will be replaced/augmented by the deployment flow. Users will now effectively be "gated" or encouraged to deploy before moving to Phase 3, although manual tab switching is still possible via the top nav.

## Proposed Changes

### Component: [VaultPage](file:///c:/Users/Waris%20Rawa/Desktop/ai-marketing-automation/app/vault/page.jsx#554-3522) ([app/vault/page.jsx](file:///c:/Users/Waris%20Rawa/Desktop/ai-marketing-automation/app/vault/page.jsx))

#### [MODIFY] [page.jsx](file:///c:/Users/Waris%20Rawa/Desktop/ai-marketing-automation/app/vault/page.jsx)
- **Locate**: The `isPhase2Complete` && `hasFunnelChoice` block (approx lines 3269-3291).
- **Changes**:
    - Replace the existing "Proceed to Phase 3" button.
    - **Condition 1: Not Deployed (`!dataSource?.deployed_at`)**:
        - Show "Build Your Funnel" button.
        - Icon: `Rocket`.
        - Action: [handleDeployToGHL](file:///c:/Users/Waris%20Rawa/Desktop/ai-marketing-automation/app/vault/page.jsx#1418-1519).
    - **Condition 2: Deployed (`dataSource?.deployed_at`)**:
        - Show "Funnel Deployed" status (Visual indicator/Disabled button).
        - Show "Proceed to Phase 3" button.
        - Icon: `Sparkles` or `ArrowRight`.
        - Action: `setActiveTab('scripts')`.

- **Verify**: `ActionModal` logic.
    - Ensure `secondaryAction` on success (`deploymentComplete`) navigates to Phase 3 (`setActiveTab('scripts')`). (Confirmed in research: `secondaryAction={deploymentComplete ? () => { ... setActiveTab('scripts'); } : ...}`).

## Verification Plan

### Manual Verification
1.  **Navigate to Vault**: Ensure you are in a session with Phase 2 incomplete or simulate it.
2.  **Complete Phase 2**: Approve all sections in Phase 2.
3.  **Check UI**: Verify "Build Your Funnel" button appears in the success card at the bottom of Phase 2.
4.  **Click Build**: Click the button.
5.  **Mock Deployment**: Since we might not want to actually deploy to GHL every time, we can rely on the existing mock/simulation if available, or just verify the [handleDeployToGHL](file:///c:/Users/Waris%20Rawa/Desktop/ai-marketing-automation/app/vault/page.jsx#1418-1519) call is made. *Self-correction: The current [handleDeployToGHL](file:///c:/Users/Waris%20Rawa/Desktop/ai-marketing-automation/app/vault/page.jsx#1418-1519) makes real API calls. I will verify the UI state changes up to the call.*
6.  **Verify Modal**: Ensure the modal appears with "Deploying..." state.
7.  **Verify Success State**: After deployment, check if the modal shows "Go to Builder" and "Proceed to Phase 3".
8.  **Click Proceed**: Click "Proceed to Phase 3" and verify it switches tabs.
9.  **Check Phase 2 Again**: Go back to Phase 2 and verify the button now says "Funnel Deployed" or similar, and "Proceed to Phase 3" is available.
